<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµØ¯Ø§Ù‚Ø© ğŸ’™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .welcome-screen, .setup-screen, .quiz-screen, .result-screen {
            display: none;
        }

        .welcome-screen.active, .setup-screen.active, .quiz-screen.active, .result-screen.active {
            display: block;
        }
        
        .mode-selection {
            display: flex;
            gap: 20px;
            margin: 30px 0;
        }
        
        .mode-btn {
            flex: 1;
            background: #f5f5f5;
            border: 3px solid #e0e0e0;
            padding: 30px 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .mode-btn:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .mode-btn h3 {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        .mode-btn p {
            color: #666;
            font-size: 1em;
        }
        
        .name-input-container {
            margin: 30px 0;
            text-align: center;
        }
        
        .name-input-container label {
            display: block;
            color: #667eea;
            font-size: 1.1em;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .name-input-container input {
            width: 100%;
            max-width: 300px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1em;
            text-align: center;
            transition: border-color 0.3s;
        }
        
        .name-input-container input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .names-display {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .names-display p {
            color: #666;
            margin: 5px 0;
        }
        
        .names-display strong {
            color: #667eea;
        }
        
        .leaderboard {
            margin-top: 30px;
            background: #f9f9f9;
            padding: 20px;
            border-radius: 15px;
        }
        
        .leaderboard h3 {
            color: #667eea;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .leaderboard-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .leaderboard-item:hover {
            transform: translateX(-5px);
        }
        
        .leaderboard-rank {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            min-width: 40px;
        }
        
        .leaderboard-rank.gold {
            color: #FFD700;
        }
        
        .leaderboard-rank.silver {
            color: #C0C0C0;
        }
        
        .leaderboard-rank.bronze {
            color: #CD7F32;
        }
        
        .leaderboard-info {
            flex: 1;
            margin: 0 15px;
        }
        
        .leaderboard-name {
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }
        
        .leaderboard-date {
            font-size: 0.85em;
            color: #999;
            margin-top: 3px;
        }
        
        .leaderboard-score {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
        }
        
        .leaderboard-empty {
            text-align: center;
            color: #999;
            padding: 20px;
        }
        
        .clear-leaderboard-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 15px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            transition: background 0.3s;
        }
        
        .clear-leaderboard-btn:hover {
            background: #ee5a52;
        }
        
        .setup-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .setup-header h2 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .setup-header p {
            color: #666;
        }

        .start-btn, .next-btn, .restart-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            display: block;
            margin: 20px auto;
        }

        .start-btn:hover, .next-btn:hover, .restart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .progress-bar {
            background: #e0e0e0;
            height: 10px;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }

        .question-container {
            margin-bottom: 30px;
        }

        .question-number {
            color: #764ba2;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            background: #f5f5f5;
            border: 2px solid transparent;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1em;
        }

        .option:hover {
            background: #ebebeb;
            transform: translateX(-5px);
        }

        .option.selected {
            background: #e8eaf6;
            border-color: #667eea;
        }

        .result-screen {
            text-align: center;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 30px auto;
            color: white;
        }

        .score-number {
            font-size: 3em;
            font-weight: bold;
        }

        .score-text {
            font-size: 1.2em;
        }

        .result-message {
            font-size: 1.5em;
            color: #333;
            margin: 20px 0;
            font-weight: 600;
        }

        .result-description {
            color: #666;
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .question-text {
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµØ¯Ø§Ù‚Ø© ğŸ’™</h1>
            <p>Ø§ÙƒØªØ´Ù Ù…Ø¯Ù‰ Ù…Ø¹Ø±ÙØªÙƒ Ø¨ØµØ¯ÙŠÙ‚Ùƒ!</p>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
        <div class="welcome-screen active">
            <p style="text-align: center; font-size: 1.2em; color: #666; margin: 20px 0;">
                Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµØ¯Ø§Ù‚Ø©! ğŸ‰
            </p>
            
            <div class="name-input-container">
                <label for="userName">Ù…Ø§ Ø§Ø³Ù…ÙƒØŸ</label>
                <input type="text" id="userName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§" maxlength="20">
            </div>
            
            <div class="mode-selection">
                <div class="mode-btn" onclick="selectMode('setup')">
                    <h3>ğŸ“</h3>
                    <h3>Ø£Ù†Ø§ Ø£Ø¶Ø¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</h3>
                    <p>Ø§Ø®ØªØ± Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ø«Ù… Ø´Ø§Ø±Ùƒ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹ ØµØ¯ÙŠÙ‚Ùƒ</p>
                </div>
                <div class="mode-btn" onclick="selectMode('test')">
                    <h3>ğŸ¯</h3>
                    <h3>Ø£Ù†Ø§ Ø£Ø®ØªØ¨Ø± Ù…Ø¹Ø±ÙØªÙŠ</h3>
                    <p>Ø­Ø§ÙˆÙ„ ØªØ®Ù…ÙŠÙ† Ø¥Ø¬Ø§Ø¨Ø§Øª ØµØ¯ÙŠÙ‚Ùƒ</p>
                </div>
            </div>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª -->
        <div class="setup-screen">
            <div class="names-display" id="setupNamesDisplay"></div>
            
            <div class="setup-header">
                <h2>Ø§Ø®ØªØ± Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</h2>
                <p>ØµØ¯ÙŠÙ‚Ùƒ Ø³ÙŠØ­Ø§ÙˆÙ„ ØªØ®Ù…ÙŠÙ† Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</p>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="setupProgressFill"></div>
            </div>

            <div class="question-container">
                <div class="question-number" id="setupQuestionNumber"></div>
                <div class="question-text" id="setupQuestionText"></div>
                <div class="options" id="setupOptionsContainer"></div>
            </div>

            <button class="next-btn" id="setupNextBtn" onclick="nextSetupQuestion()" style="display: none;">
                Ø§Ù„ØªØ§Ù„ÙŠ
            </button>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
        <div class="quiz-screen">
            <div class="names-display" id="quizNamesDisplay"></div>
            
            <div class="setup-header">
                <h2>Ø­Ø§ÙˆÙ„ ØªØ®Ù…ÙŠÙ† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©!</h2>
                <p>Ø§Ø®ØªØ± Ù…Ø§ ØªØ¹ØªÙ‚Ø¯ Ø£Ù†Ù‡ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</p>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="question-container">
                <div class="question-number" id="questionNumber"></div>
                <div class="question-text" id="questionText"></div>
                <div class="options" id="optionsContainer"></div>
            </div>

            <button class="next-btn" id="nextBtn" onclick="nextQuestion()" style="display: none;">
                Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
            </button>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
        <div class="result-screen">
            <div class="names-display" id="resultNamesDisplay"></div>
            
            <div class="score-circle">
                <div class="score-number" id="scoreNumber"></div>
                <div class="score-text">Ù…Ù† 10</div>
            </div>
            <div class="result-message" id="resultMessage"></div>
            <div class="result-description" id="resultDescription"></div>
            
            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† -->
            <div class="leaderboard" id="leaderboardSection" style="display: none;">
                <h3>ğŸ† Ù‚Ø§Ø¦Ù…Ø© Ø£ÙØ¶Ù„ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</h3>
                <div id="leaderboardList"></div>
                <button class="clear-leaderboard-btn" onclick="clearLeaderboard()">Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
            </div>
            
            <button class="restart-btn" onclick="restartQuiz()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
        </div>
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        const questions = [
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ù„ÙˆÙ†ÙŠ Ø§Ù„Ù…ÙØ¶Ù„ØŸ",
                options: ["Ø§Ù„Ø£Ø²Ø±Ù‚", "Ø§Ù„Ø£Ø­Ù…Ø±", "Ø§Ù„Ø£Ø®Ø¶Ø±", "Ø§Ù„Ø£ØµÙØ±"]
            },
            {
                question: "Ù…Ø§ Ù‡ÙŠ Ù‡ÙˆØ§ÙŠØªÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø©ØŸ",
                options: ["Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©", "Ø§Ù„Ø±ÙŠØ§Ø¶Ø©", "Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰", "Ø§Ù„Ø±Ø³Ù…"]
            },
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ø·Ø¹Ø§Ù…ÙŠ Ø§Ù„Ù…ÙØ¶Ù„ØŸ",
                options: ["Ø§Ù„Ø¨ÙŠØªØ²Ø§", "Ø§Ù„Ù…Ø¹ÙƒØ±ÙˆÙ†Ø©", "Ø§Ù„Ø¨Ø±Ø¬Ø±", "Ø§Ù„Ø³ÙˆØ´ÙŠ"]
            },
            {
                question: "Ù…Ø§ Ù‡Ùˆ ÙØµÙ„ÙŠ Ø§Ù„Ù…ÙØ¶Ù„ØŸ",
                options: ["Ø§Ù„Ø±Ø¨ÙŠØ¹", "Ø§Ù„ØµÙŠÙ", "Ø§Ù„Ø®Ø±ÙŠÙ", "Ø§Ù„Ø´ØªØ§Ø¡"]
            },
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ù†ÙˆØ¹ Ø§Ù„Ø£ÙÙ„Ø§Ù… Ø§Ù„Ù…ÙØ¶Ù„ Ù„Ø¯ÙŠØŸ",
                options: ["Ø§Ù„Ø£ÙƒØ´Ù†", "Ø§Ù„ÙƒÙˆÙ…ÙŠØ¯ÙŠØ§", "Ø§Ù„Ø±Ø¹Ø¨", "Ø§Ù„Ø¯Ø±Ø§Ù…Ø§"]
            },
            {
                question: "Ù…Ø§ Ù‡ÙŠ Ø§Ù„ÙˆØ¬Ù‡Ø© Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ© Ø§Ù„ØªÙŠ Ø£Ø­Ù„Ù… Ø¨Ø²ÙŠØ§Ø±ØªÙ‡Ø§ØŸ",
                options: ["Ø¨Ø§Ø±ÙŠØ³", "Ø·ÙˆÙƒÙŠÙˆ", "Ù†ÙŠÙˆÙŠÙˆØ±Ùƒ", "Ø¯Ø¨ÙŠ"]
            },
            {
                question: "Ù…Ø§ Ù‡ÙŠ Ø±ÙŠØ§Ø¶ØªÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø©ØŸ",
                options: ["ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…", "ÙƒØ±Ø© Ø§Ù„Ø³Ù„Ø©", "Ø§Ù„Ø³Ø¨Ø§Ø­Ø©", "Ø§Ù„ØªÙ†Ø³"]
            },
            {
                question: "Ù…Ø§Ø°Ø§ Ø£ÙØ¶Ù„ ÙÙŠ Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ØŸ",
                options: ["Ø§Ù„Ø¨Ù‚Ø§Ø¡ ÙÙŠ Ø§Ù„Ù…Ù†Ø²Ù„", "Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ø¹ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡", "Ø§Ù„Ø³ÙØ±", "Ù…Ù…Ø§Ø±Ø³Ø© Ø§Ù„Ø±ÙŠØ§Ø¶Ø©"]
            },
            {
                question: "Ù…Ø§ Ù‡Ùˆ Ù†ÙˆØ¹ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ù…ÙØ¶Ù„ Ù„Ø¯ÙŠØŸ",
                options: ["Ø§Ù„Ø¨ÙˆØ¨", "Ø§Ù„Ø±ÙˆÙƒ", "Ø§Ù„Ø±Ø§Ø¨", "Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒ"]
            },
            {
                question: "Ù…Ø§ Ù‡ÙŠ Ø£ÙƒØ«Ø± ØµÙØ© Ø£ØªÙ…ÙŠØ² Ø¨Ù‡Ø§ØŸ",
                options: ["Ø§Ù„ÙƒØ±Ù…", "Ø§Ù„ØµØ¯Ù‚", "Ø§Ù„Ø¥Ø®Ù„Ø§Øµ", "Ø±ÙˆØ­ Ø§Ù„Ø¯Ø¹Ø§Ø¨Ø©"]
            }
        ];

        let currentMode = ''; // 'setup' or 'test'
        let myAnswers = []; // Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£ØµÙ„ÙŠ
        let currentQuestion = 0;
        let score = 0;
        let selectedAnswer = null;
        let ownerName = ''; // Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
        let testerName = ''; // Ø§Ø³Ù… Ø§Ù„Ù…Ø®ØªØ¨ÙØ±

        function selectMode(mode) {
            const userName = document.getElementById('userName').value.trim();
            
            if (!userName) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹!');
                return;
            }
            
            currentMode = mode;
            document.querySelector('.welcome-screen').classList.remove('active');
            
            if (mode === 'setup') {
                // Ø¥Ø°Ø§ Ø§Ø®ØªØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¶Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
                ownerName = userName;
                document.querySelector('.setup-screen').classList.add('active');
                document.getElementById('setupNamesDisplay').innerHTML = 
                    `<p>ğŸ‘¤ <strong>${ownerName}</strong> ÙŠØ¶Ø¹ Ø¥Ø¬Ø§Ø¨Ø§ØªÙ‡</p>`;
                currentQuestion = 0;
                myAnswers = [];
                showSetupQuestion();
            } else {
                // Ø¥Ø°Ø§ Ø§Ø®ØªØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                testerName = userName;
                // Ù†ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©
                const savedAnswers = localStorage.getItem('friendshipQuizAnswers');
                const savedOwnerName = localStorage.getItem('friendshipQuizOwnerName');
                
                if (savedAnswers && savedOwnerName) {
                    myAnswers = JSON.parse(savedAnswers);
                    ownerName = savedOwnerName;
                    document.querySelector('.quiz-screen').classList.add('active');
                    document.getElementById('quizNamesDisplay').innerHTML = 
                        `<p>ğŸ¯ <strong>${testerName}</strong> ÙŠØ®ØªØ¨Ø± Ù…Ø¹Ø±ÙØªÙ‡ Ø¨Ù€ <strong>${ownerName}</strong></p>`;
                    currentQuestion = 0;
                    score = 0;
                    showQuestion();
                } else {
                    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©! ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ ØµØ¯ÙŠÙ‚Ùƒ Ø£ÙˆÙ„Ø§Ù‹ Ø£Ù† ÙŠØ¶Ø¹ Ø¥Ø¬Ø§Ø¨Ø§ØªÙ‡.');
                    document.querySelector('.welcome-screen').classList.add('active');
                }
            }
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯
        function showSetupQuestion() {
            const question = questions[currentQuestion];
            document.getElementById('setupQuestionNumber').textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentQuestion + 1} Ù…Ù† ${questions.length}`;
            document.getElementById('setupQuestionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('setupOptionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectSetupOption(index);
                optionsContainer.appendChild(optionDiv);
            });

            updateSetupProgress();
            selectedAnswer = null;
            document.getElementById('setupNextBtn').style.display = 'none';
        }

        function selectSetupOption(index) {
            selectedAnswer = index;
            const options = document.querySelectorAll('#setupOptionsContainer .option');
            options.forEach((opt, i) => {
                opt.classList.toggle('selected', i === index);
            });
            document.getElementById('setupNextBtn').style.display = 'block';
        }

        function nextSetupQuestion() {
            if (selectedAnswer === null) return;

            myAnswers.push(selectedAnswer);
            currentQuestion++;

            if (currentQuestion < questions.length) {
                showSetupQuestion();
            } else {
                finishSetup();
            }
        }

        function updateSetupProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('setupProgressFill').style.width = progress + '%';
        }

        function finishSetup() {
            // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª ÙˆØ§Ø³Ù… ØµØ§Ø­Ø¨Ù‡Ø§ ÙÙŠ LocalStorage
            localStorage.setItem('friendshipQuizAnswers', JSON.stringify(myAnswers));
            localStorage.setItem('friendshipQuizOwnerName', ownerName);
            
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
            document.querySelector('.setup-screen').classList.remove('active');
            document.querySelector('.result-screen').classList.add('active');
            
            document.getElementById('resultNamesDisplay').innerHTML = 
                `<p>âœ… ØªÙ… Ø­ÙØ¸ Ø¥Ø¬Ø§Ø¨Ø§Øª <strong>${ownerName}</strong></p>`;
            document.getElementById('scoreNumber').textContent = 'âœ“';
            document.getElementById('resultMessage').textContent = 'ØªÙ… Ø­ÙØ¸ Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ!';
            document.getElementById('resultDescription').innerHTML = 
                'Ø§Ù„Ø¢Ù† Ø´Ø§Ø±Ùƒ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ø¹ ØµØ¯ÙŠÙ‚Ùƒ Ù„ÙŠØ®ØªØ¨Ø± Ù…Ø¹Ø±ÙØªÙ‡ Ø¨Ùƒ!<br><br>' +
                '<strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙØªØ­ ØµØ¯ÙŠÙ‚Ùƒ Ù†ÙØ³ Ø§Ù„ØµÙØ­Ø© Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ù…ØªØµÙØ­ ÙˆÙ†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø²ØŒ Ø«Ù… ÙŠØ®ØªØ§Ø± "Ø£Ù†Ø§ Ø£Ø®ØªØ¨Ø± Ù…Ø¹Ø±ÙØªÙŠ".';
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function showQuestion() {
            const question = questions[currentQuestion];
            document.getElementById('questionNumber').textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentQuestion + 1} Ù…Ù† ${questions.length}`;
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });

            updateProgress();
            selectedAnswer = null;
            document.getElementById('nextBtn').style.display = 'none';
        }

        function selectOption(index) {
            selectedAnswer = index;
            const options = document.querySelectorAll('#optionsContainer .option');
            options.forEach((opt, i) => {
                opt.classList.toggle('selected', i === index);
            });
            document.getElementById('nextBtn').style.display = 'block';
        }

        function nextQuestion() {
            if (selectedAnswer === null) return;

            // Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            if (selectedAnswer === myAnswers[currentQuestion]) {
                score++;
            }

            currentQuestion++;

            if (currentQuestion < questions.length) {
                showQuestion();
            } else {
                showResults();
            }
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function showResults() {
            document.querySelector('.quiz-screen').classList.remove('active');
            document.querySelector('.result-screen').classList.add('active');

            document.getElementById('resultNamesDisplay').innerHTML = 
                `<p>ğŸ¯ <strong>${testerName}</strong> Ø­ØµÙ„ Ø¹Ù„Ù‰ <strong>${score}</strong> Ù…Ù† <strong>10</strong> ÙÙŠ Ù…Ø¹Ø±ÙØ© <strong>${ownerName}</strong></p>`;
            
            document.getElementById('scoreNumber').textContent = score;

            // Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†
            saveToLeaderboard(testerName, score);
            displayLeaderboard();

            let message, description;

            if (score >= 9) {
                message = "Ù…Ù…ØªØ§Ø²! ğŸŒŸ";
                description = `${testerName}ØŒ Ø£Ù†Øª ØªØ¹Ø±Ù ${ownerName} Ø¨Ø´ÙƒÙ„ Ø±Ø§Ø¦Ø¹! ØµØ¯Ø§Ù‚ØªÙƒÙ… Ù‚ÙˆÙŠØ© ÙˆÙ…Ù…ÙŠØ²Ø© Ø¬Ø¯Ø§Ù‹.`;
            } else if (score >= 7) {
                message = "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹! ğŸ‘";
                description = `${testerName}ØŒ ØªØ¹Ø±Ù ${ownerName} Ø¬ÙŠØ¯Ø§Ù‹ØŒ Ù„ÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø¬Ø§Ù„ Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯.`;
            } else if (score >= 5) {
                message = "Ø¬ÙŠØ¯! ğŸ‘";
                description = `${testerName}ØŒ Ù„Ø¯ÙŠÙƒ Ù…Ø¹Ø±ÙØ© Ø¬ÙŠØ¯Ø© Ø¨Ù€ ${ownerName}ØŒ Ø­Ø§ÙˆÙ„ÙˆØ§ Ù‚Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ù…Ø¹Ø§Ù‹.`;
            } else {
                message = "ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø³ÙŠÙ† Ù…Ø¹Ø±ÙØªÙƒ! ğŸ’ª";
                description = `${testerName}ØŒ ÙŠØ¨Ø¯Ùˆ Ø£Ù†Ùƒ Ø¨Ø­Ø§Ø¬Ø© Ù„Ù‚Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ù…Ø¹ ${ownerName} Ù„Ù…Ø¹Ø±ÙØªÙ‡ Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„.`;
            }

            document.getElementById('resultMessage').textContent = message;
            document.getElementById('resultDescription').textContent = description;
        }

        function saveToLeaderboard(name, score) {
            let leaderboard = JSON.parse(localStorage.getItem('friendshipLeaderboard') || '[]');
            
            const now = new Date();
            const dateString = now.toLocaleDateString('ar-DZ', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            leaderboard.push({
                name: name,
                score: score,
                date: dateString,
                timestamp: now.getTime()
            });
            
            // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· (Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ù‚Ù„) Ø«Ù… Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
            leaderboard.sort((a, b) => {
                if (b.score !== a.score) {
                    return b.score - a.score;
                }
                return b.timestamp - a.timestamp;
            });
            
            localStorage.setItem('friendshipLeaderboard', JSON.stringify(leaderboard));
        }

        function displayLeaderboard() {
            const leaderboard = JSON.parse(localStorage.getItem('friendshipLeaderboard') || '[]');
            const leaderboardList = document.getElementById('leaderboardList');
            const leaderboardSection = document.getElementById('leaderboardSection');
            
            if (leaderboard.length === 0) {
                leaderboardSection.style.display = 'none';
                return;
            }
            
            leaderboardSection.style.display = 'block';
            leaderboardList.innerHTML = '';
            
            leaderboard.forEach((entry, index) => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                
                let rankClass = '';
                let rankIcon = `${index + 1}`;
                
                if (index === 0) {
                    rankClass = 'gold';
                    rankIcon = 'ğŸ¥‡';
                } else if (index === 1) {
                    rankClass = 'silver';
                    rankIcon = 'ğŸ¥ˆ';
                } else if (index === 2) {
                    rankClass = 'bronze';
                    rankIcon = 'ğŸ¥‰';
                }
                
                item.innerHTML = `
                    <div class="leaderboard-rank ${rankClass}">${rankIcon}</div>
                    <div class="leaderboard-info">
                        <div class="leaderboard-name">${entry.name}</div>
                        <div class="leaderboard-date">${entry.date}</div>
                    </div>
                    <div class="leaderboard-score">${entry.score}/10</div>
                `;
                
                leaderboardList.appendChild(item);
            });
        }

        function clearLeaderboard() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†ØŸ')) {
                localStorage.removeItem('friendshipLeaderboard');
                displayLeaderboard();
            }
        }

        function restartQuiz() {
            currentQuestion = 0;
            score = 0;
            selectedAnswer = null;
            myAnswers = [];
            ownerName = '';
            testerName = '';
            document.getElementById('userName').value = '';
            document.querySelector('.result-screen').classList.remove('active');
            document.querySelector('.welcome-screen').classList.add('active');
        }
    </script>
</body>
</html>